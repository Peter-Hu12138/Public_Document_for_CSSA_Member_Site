# Public_Document_for_UTCSSA_Member_Site

以下为多大中国学生学者协会的成员管理网站的公开文档。该网站由[我][Peter-Hu12138](https://github.com/Peter-Hu12138/)开发。特别致谢：(郑栋耀)[https://github.com/QwQ1231043]帮我完成了两个app的蓝图，(多多)[https://github.com/sduoduo233]在网站开发中给了我许多建议。

### 部署方法 （待完成，具体部署方法为nginx + gunicorn）
1. `python manage.py migrate`
2. `python manage.py runserver 0.0.0.0` 

### 成员系统说明

#### 成员属性
1. 基本信息:
   - Email (作为用户名)
   - 姓名 (given_name, surname)
   - 学生信息 (student_number, faculty, college等)
   - 个人目标 (personal_goal)

2. 角色信息:
   - 部门归属 (department)
   - 部门内角色 (role_within_department):
     * HD (Head/部长)
     * DH (Deputy Head/副部长)
   - 社团职位 (title):
     * P (President/主席)
     * VP (Vice President/副主席)
     * D (Director/总监)
     * DD (Deputy Director/副总监)

#### 隐私控制
1. 可控制显示项目:
   - preferred_name
   - faculty
   - college
   - program
   - year_of_study

2. 每项信息都有对应的显示开关:
   - if_show_preferred_name
   - if_show_faculty
   - if_show_college
   - if_show_program
   - if_show_year_of_study

#### 成员管理
1. 批量导入:
   - 通过CSV文件批量创建账户
   - 自动生成随机密码
   - 导出账户信息

2. 个人资料:
   - 成员可以编辑自己的个人信息
   - 可以设置信息的公开范围
   - 查看其他成员的公开信息

#### 权限验证
1. 部门主管限制:
   - 每个部门只能有一位部长
   - 每个部门只能有一位副部长
   - 系统自动验证避免冲突

2. 登录要求:
   - 大部分功能需要登录后使用
   - 特定功能需要相应的角色权限


### 部门系统说明

#### 部门结构
1. 层级关系:
   - 部门可以有一个上级部门(super_department)
   - 部门可以有多个下级部门(sub_departments)
   - 形成树状结构，便于管理

2. 部门属性:
   - name: 部门名称
   - has_event_review: 是否有活动审核权限
   - 部长(Head)和副部长(Deputy Head)信息

#### 部门视图
1. 部门树状图:
   - 显示完整的部门层级关系
   - 包含每个部门的负责人信息
   - 显示部门下属成员列表

### 工作系统权限说明

#### 发布权限
1. 部长 (Head):
   - 可以给本部门所有成员（包括自己）布置工作
   - 可以给直接附属部门的部长布置工作
   - 工作状态直接设为"进行中"，无需审核

2. 副部长 (Deputy Head):
   - 可以给本部门所有成员（除部长外）布置工作
   - 工作状态直接设为"进行中"，无需审核

3. 普通成员:
   - 只能给自己布置工作
   - 工作状态初始为"待审核"，需要审核

#### 审核权限
1. 审核人员:
   - 部长和副部长可以审核本部门成员提交的工作
   - 对于附属部门，上级部门的部长可以审核下级部门的工作

2. 审核流程:
   - 普通成员提交工作后，状态为"待审核"
   - 部长/副部长可以选择:
     * 批准：状态变为"进行中"
     * 拒绝：状态变为"已拒绝"
   - 工作完成后，审核人可以将状态改为"已完成"

#### 浏览权限
1. 个人权限:
   - 每个成员可以查看自己创建或负责的所有工作
   - 可以查看自己的所有工作记录

2. 管理层权限:
   - 部长可以查看本部门及所有下属部门的工作和工作记录
   - 副部长可以查看本部门所有成员（除部长外）的工作和工作记录

#### 工作记录权限
- 只有工作的创建者和负责人可以添加工作记录
- 仅当工作状态为"进行中"时才能添加记录

### 活动系统权限说明

#### 发布权限
1. 成员发布活动:
   - 所有成员均可发布活动
   - 新建活动默认状态为"待审核"
   - 活动需要指定负责部门

2. 活动审核部门:
   - 在Department模型中通过`has_event_review`字段标记具有活动审核权限的部门
   - 只有被标记的部门的部长和副部长可以审核活动

#### 审核流程
1. 活动状态:
   - PENDING (待审核)
   - APPROVED (已批准)
   - REJECTED (已拒绝)
   - COMPLETED (已完成)

2. 审核权限:
   - 具有审核权限的部门的部长和副部长可以审核活动
   - 可以将活动状态从"待审核"改为"已批准"或"已拒绝"

#### 活动记录权限
1. 记录添加:
   - 所有参与活动的成员都可以为自己添加活动记录
   - 记录包含参与时长和具体工作内容
   - 活动结束后可继续添加记录

2. 记录查看:
   - 成员可以查看自己的所有活动记录
   - 部长可以查看本部门所有成员的活动记录

### 管理员功能说明

#### 用户管理
1. 批量添加用户:
   - 通过admin界面上传包含邮箱
   - 系统自动为每个邮箱创建账户并生成随机密码
   - 导出包含账户信息的CSV文件

2. 用户设置:
   - 设置用户所属部门
   - 分配部门内角色（部长/副部长/普通成员）
   - 设置用户在社团中的职位

#### 部门管理
1. 部门结构:
   - 可以设置部门层级关系
   - 标记具有活动审核权限的部门
   - 管理部门的负责人和成员


### 安全措施:
   - 所有表单都需要登录验证
   - URL访问权限控制
   - 跨部门数据访问限制
   - 现在存在一些表单验证漏洞，未来将进行修正

